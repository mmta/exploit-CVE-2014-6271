FROM debian:jessie

LABEL maintainer "opsxcq@strm.sh"

RUN apt-get update && \
  apt-get upgrade -y && \
  DEBIAN_FRONTEND=noninteractive apt-get install -y \
  apache2 && \
  apt-get clean && \
  rm -rf /var/lib/apt/lists/*

COPY packages /packages

RUN dpkg -i /packages/*

COPY vulnerable /usr/lib/cgi-bin/
COPY index.html /root/

RUN a2enmod cgi headers rewrite

# enable CORS, bruteforce mode
RUN sed -i '/<\/VirtualHost>/d' /etc/apache2/sites-enabled/000-default.conf
RUN echo '\nHeader always set Access-Control-Allow-Origin "*"\n\
  Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT"\n\
  Header always set Access-Control-Max-Age "1000"\n\
  Header always set Access-Control-Allow-Headers "x-custom-header, x-requested-with, Content-Type, origin, authorization, accept, client-security-token"\n\
  RewriteEngine On\n\
  RewriteCond %{REQUEST_METHOD} OPTIONS\n\
  RewriteRule ^(.*)$ $1 [R=200,L]\n\
  </VirtualHost>\n'\
  >> /etc/apache2/sites-enabled/000-default.conf

EXPOSE 80

COPY main.sh /

CMD ["/main.sh"]

